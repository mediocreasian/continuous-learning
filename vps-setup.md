
### Packages installed on the VPS so far:

- ufw
- fail2ban
- nvim for editing
- Docker
- Docker Credential Helpers (For )


### SSH Config

#### Pre-requisite:

- Use user , do not use Root
- Ensure user is part of the Sudo Group
  eg.
  ```
  sudo adduser exeltan
  sudo usermod -aG sudo exeltan
  ```

1. Edit /etc/ssh/sshd_config , turn off PasswordAuthentication

   ```
   PasswordAuthentication no
   ```

   Once complete written

   ```
   sudo systemctl restart ssh
   ```

2. Generate public and private Key via PuttyGen

3. Add Public Key generated from Putty Gen to VPS

```
cat /path/to/local/id_rsa.pub | ssh user@your_vps 'cat >> ~/.ssh/authorized_keys'
```

4. Open PuTTY, go to Connection > SSH > Auth and select the correct .ppk file for your private key.



### Systemmd;

1. Check if I am using systemd:

```
ps -p 1 -o comm=
```

2. Systemmd Unit and Config files:

   _/etc/systemd/system/:_

   - This directory is the primary location for system-wide service configuration files (unit files).
   - Unit files define how services are started, stopped, and managed.
   - User created services should go here.

   _/usr/lib/systemd/system/:_

   - This directory contains unit files provided by installed software packages.
   - You should generally avoid modifying files in this directory directly, as they can be overwritten during package updates.

   _/run/systemd/system/:_

   - This directory holds unit files generated at runtime.
   - These files are typically created by other programs or systemd itself

   _/etc/systemd/system.conf:_

   - This file contains system-wide systemd settings.

   _/etc/systemd/journald.conf:_

   - This file configures the systemd journal (logging).

   _/etc/systemd/logind.conf:_

   - This file configures the systemd login manager.

   _/etc/systemd/resolved.conf:_

   - This file configures the systemd-resolved DNS resolver service.

   _/etc/systemd/timesyncd.conf:_

   - This file configures the systemd-timesyncd time synchronization service.

   _/run/systemd/:_

   - This directory contains runtime data and configuration for systemd.

3. ##### Making changes to systemd config files , need to reload this

```
sudo systemctl daemon-reload
```

4. ##### To restart the service , need to reload this

```
 sudo systemctl restart <servicename>
```



# Setup Fail2ban :

#### 0. Restart Fail2ban Service

```
sudo systemctl restart fail2ban
```

#### 1. check Status of Fail2ban

```
sudo systemctl status fail2ban
```

#### 2. Check the status of the sshd jail

```
sudo fail2ban-client status sshd
```

#### 3. Check Fail2ban logs:

```
/var/log/fail2ban.log
```

- This file contains logs generated by the Fail2ban service itself.
- It's focused on Fail2ban's internal actions and decisions.
- It tells you what Fail2ban is doing.

4. Check SSH Server Log

```
journalctl -u sshd.service
```

- This command retrieves logs from the systemd-journald journal, specifically filtering for logs related to the sshd.service (the SSH daemon).
- It contains logs generated by the SSH server itself.
- It records events related to SSH login attempts, connections, and other SSH-related activities.

# Setup UFW :

#### 1. Check the status of UFW with:

```
sudo ufw status numbered
```

#### 2. Enable UFW Logging

```
sudo ufw logging medium
```

#### 3. Get UFW Logs:

```
sudo journalctl | grep UFW
```

#### 4. Allow other services that VPS needs to be accessible, such as:
   - ##### HTTP (port 80):
   ```
   sudo ufw allow http
   ```
   ##### HTTPS (port 443):
   ```
   sudo ufw allow https
   ```
   ###  SSH (port 22) *Super important if not you won't be able to access your VPS* 
   ```bash
   sudo ufw allow ssh
   ```


# Docker for VPS :

1. Install Necessary Packages:

```
sudo apt install apt-transport-https ca-certificates curl software-properties-common
```

2. Add Docker's Official GPG Key:

```
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
```

3.  sets the correct permissions for the key.

```
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

4. Add the Docker Repository:

```
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(. /etc/os-release && echo \"$VERSION_CODENAME\") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

5. Install Docker Engine:

```
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io
```

6. Verify Docker Installation:

```
sudo docker run hello-world
```

7. Add User to Docker Group (Recommended):

```
sudo usermod -aG docker $USER
newgrp docker
```

8. Enable Docker on Boot:

```
sudo systemctl enable docker
```

9. Install Docker Compose on Server:

```
sudo apt install docker-compose-plugin
```

#  Setting Up `pass` with `docker-credential-helpers`

This guide walks you through securely storing Docker credentials using [`pass`](https://www.passwordstore.org/) and [`docker-credential-helpers`](https://github.com/docker/docker-credential-helpers), which allows Docker to save registry credentials in an encrypted GPG-based password store.

---

##  Prerequisites

Make sure the following are installed:

- `gpg` (GNU Privacy Guard)
- `pass` (UNIX password manager)
- Docker
- `docker-credential-pass` (part of `docker-credential-helpers`)

---

##  Installation Steps

### 1.  Install Required Tools

```bash
sudo apt update
sudo apt install gnupg pass docker-credential-helpers -y
```

If `docker-credential-helpers` package is unavailable:

```bash
# Manually install the helper
sudo apt install golang-go -y
git clone https://github.com/docker/docker-credential-helpers.git
cd docker-credential-helpers
make pass
sudo cp bin/docker-credential-pass /usr/local/bin/
```

---

### 2.  Generate GPG Key (If You Don't Have One)

```bash
gpg --full-generate-key
```

- Choose RSA
- Key size: 4096
- Set expiration as needed
- Use your name and email

Get your GPG key ID:

```bash
gpg --list-keys
```

Example:
```
pub   rsa4096 2025-04-19 [SC]
      9ABCDEF1234567890ABCDEF123456789ABCDEF12
```

---

### 3.  Initialize Pass with GPG Key

```bash
pass init 9ABCDEF1234567890ABCDEF123456789ABCDEF12
```

Replace with your actual GPG key ID.

---

### 4.  Configure Docker to Use `pass` Helper

Create or modify `~/.docker/config.json`:

```json
{
  "credsStore": "pass"
}
```

This tells Docker to use the `docker-credential-pass` binary when storing credentials.

---

### 5.  Login to Docker Registry

Try logging in to a registry:

```bash
docker login ghcr.io
```

You’ll be prompted for your credentials, and they’ll be encrypted and saved using `pass`.

---

##  Password Store Location

Your credentials will be saved in:

```bash
~/.password-store/docker-credential-helpers/https---ghcr.io.gpg
```

To view it:

```bash
pass show docker-credential-helpers/https://ghcr.io
```

---

##  Clean Up

To delete saved credentials:

```bash
pass rm docker-credential-helpers/https://ghcr.io
```

To completely reset:

```bash
rm -rf ~/.password-store
gpg --delete-secret-keys <your-key-id>
```

---

##  Verify Configuration

```bash
docker-credential-pass list
```

This should print all currently stored registries.
